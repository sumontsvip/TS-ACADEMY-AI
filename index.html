<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TS ACADEMY AI – Crypto Signal Engine</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0b1220;
  color: #e5e7eb;
}
header {
  padding: 15px 30px;
  background: #020617;
  font-size: 22px;
  font-weight: bold;
  color: #38bdf8;
}
.container {
  max-width: 1100px;
  margin: 30px auto;
}
.card {
  background: #020617;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
}
.row {
  display: flex;
  justify-content: space-between;
}
.badge {
  padding: 6px 12px;
  border-radius: 6px;
  font-weight: bold;
}
.waiting { background: #334155; }
.active { background: #22c55e; color:#000; }
.tp { background: #facc15; color:#000; }
.sl { background: #ef4444; color:#000; }

.price {
  font-size: 22px;
  margin-top: 10px;
}
.logic {
  margin-top: 8px;
  color: #94a3b8;
  font-size: 14px;
}
</style>
</head>

<body>

<header>TS ACADEMY AI – Crypto (BTC / ETH)</header>

<div class="container">

  <div class="card">
    <div class="row">
      <div>BTCUSDT</div>
      <div id="btcStatus" class="badge waiting">WAITING</div>
    </div>
    <div class="price" id="btcPrice">Price: --</div>
    <div class="logic" id="btcLogic"></div>
  </div>

  <div class="card">
    <div class="row">
      <div>ETHUSDT</div>
      <div id="ethStatus" class="badge waiting">WAITING</div>
    </div>
    <div class="price" id="ethPrice">Price: --</div>
    <div class="logic" id="ethLogic"></div>
  </div>

</div>

<script>
function createEngine(symbol, priceEl, statusEl, logicEl) {

  let lastPrice = null;
  let impulseHigh = null;
  let impulseLow = null;
  let direction = null;

  let tradeActive = false;
  let entry = 0;
  let sl = 0;
  let tp = 0;

  const RR = 2; // Risk Reward 1:2

  const ws = new WebSocket(
    wss://stream.binance.com:9443/ws/${symbol}@trade
  );

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    const price = parseFloat(data.p);

    priceEl.innerText = "Price: " + price.toFixed(2);

    if (!lastPrice) {
      lastPrice = price;
      return;
    }

    const diff = price - lastPrice;

    // ===== STEP 1: Aggressive impulse =====
    if (!tradeActive && Math.abs(diff) > price * 0.0008) {
      impulseHigh = Math.max(price, lastPrice);
      impulseLow = Math.min(price, lastPrice);
      direction = diff > 0 ? "BUY" : "SELL";
    }

    // ===== STEP 2: Fibonacci 0.5 entry =====
    if (!tradeActive && impulseHigh && impulseLow) {
      const fib50 = impulseLow + (impulseHigh - impulseLow) * 0.5;

      if (Math.abs(price - fib50) < price * 0.00025) {
        entry = fib50;

        if (direction === "BUY") {
          sl = impulseLow;
          tp = entry + (entry - sl) * RR;
        } else {
          sl = impulseHigh;
          tp = entry - (sl - entry) * RR;
        }

        tradeActive = true;

        statusEl.innerText = "ACTIVE";
        statusEl.className = "badge active";

        logicEl.innerText =
          ${direction} @ ${entry.toFixed(2)} | SL ${sl.toFixed(2)} | TP ${tp.toFixed(2)} | RR 1:${RR};
      }
    }

    // ===== STEP 3: Trade management =====
    if (tradeActive) {

      // TP HIT
      if (
        (direction === "BUY" && price >= tp) ||
        (direction === "SELL" && price <= tp)
      ) {
        statusEl.innerText = "TP HIT";
        statusEl.className = "badge tp";
        logicEl.innerText = "TP achieved. Waiting new setup.";

        reset();
      }

      // SL HIT
      else if (
        (direction === "BUY" && price <= sl) ||
        (direction === "SELL" && price >= sl)
      ) {
        statusEl.innerText = "SL HIT";
        statusEl.className = "badge sl";
        logicEl.innerText = "SL hit. Setup invalidated.";

        reset();
      }
    }

    if (!tradeActive) {
      statusEl.innerText = "WAITING";
      statusEl.className = "badge waiting";
      logicEl.innerText = "Waiting aggressive move → Fib 0.5";
    }

    lastPrice = price;
  };

function reset() {
    tradeActive = false;
    impulseHigh = null;
    impulseLow = null;
    direction = null;
  }
}

// INIT
createEngine(
  "btcusdt",
  document.getElementById("btcPrice"),
  document.getElementById("btcStatus"),
  document.getElementById("btcLogic")
);

createEngine(
  "ethusdt",
  document.getElementById("ethPrice"),
  document.getElementById("ethStatus"),
  document.getElementById("ethLogic")
);
</script>

</body>
</html>
