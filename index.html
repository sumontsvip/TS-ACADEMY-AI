<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TS ACADEMY AI – Crypto Pro Engine</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0b1220;
  color: #e5e7eb;
}
header {
  padding: 15px 30px;
  background: #020617;
  font-size: 22px;
  font-weight: bold;
  color: #38bdf8;
}
.container {
  max-width: 1100px;
  margin: 30px auto;
}
.card {
  background: #020617;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
}
.row {
  display: flex;
  justify-content: space-between;
}
.badge {
  padding: 6px 12px;
  border-radius: 6px;
  font-weight: bold;
}
.waiting { background: #334155; }
.active { background: #22c55e; color:#000; }
.tp { background: #facc15; color:#000; }
.sl { background: #ef4444; color:#000; }
.htf { background:#0ea5e9; color:#000; }

.price {
  font-size: 22px;
  margin-top: 10px;
}
.logic {
  margin-top: 6px;
  font-size: 13px;
  color: #94a3b8;
}
</style>
</head>

<body>

<header>TS ACADEMY AI – Crypto (HTF Filter ON)</header>

<div class="container">

  <div class="card">
    <div class="row">
      <div>BTCUSDT</div>
      <div id="btcStatus" class="badge waiting">WAITING</div>
    </div>
    <div class="price" id="btcPrice">Price: --</div>
    <div class="logic" id="btcLogic"></div>
    <div class="logic" id="btcHTF"></div>
  </div>

  <div class="card">
    <div class="row">
      <div>ETHUSDT</div>
      <div id="ethStatus" class="badge waiting">WAITING</div>
    </div>
    <div class="price" id="ethPrice">Price: --</div>
    <div class="logic" id="ethLogic"></div>
    <div class="logic" id="ethHTF"></div>
  </div>

</div>

<script>
function createEngine(symbol, priceEl, statusEl, logicEl, htfEl) {

  let lastPrice = null;
  let pricesHTF = []; // pseudo 15m bias
  let htfBias = "NEUTRAL";

  let impulseHigh = null;
  let impulseLow = null;
  let direction = null;

  let tradeActive = false;
  let entry = 0, sl = 0, tp = 0;
  const RR = 2;

  const ws = new WebSocket(
    wss://stream.binance.com:9443/ws/${symbol}@trade
  );

  ws.onmessage = (e) => {
    const price = parseFloat(JSON.parse(e.data).p);
    priceEl.innerText = "Price: " + price.toFixed(2);

    // ===== HTF LOGIC (rolling bias) =====
    pricesHTF.push(price);
    if (pricesHTF.length > 120) pricesHTF.shift(); // ~15m feel

    if (pricesHTF.length >= 60) {
      const first = pricesHTF[0];
      const last = pricesHTF[pricesHTF.length - 1];
      htfBias = last > first ? "BULLISH" : "BEARISH";
    }

    htfEl.innerText = "HTF Bias: " + htfBias;

    if (!lastPrice) {
      lastPrice = price;
      return;
    }

    const diff = price - lastPrice;

    // ===== Aggressive impulse =====
    if (!tradeActive && Math.abs(diff) > price * 0.0008) {
      const tempDir = diff > 0 ? "BUY" : "SELL";

      // HTF FILTER
      if (
        (tempDir === "BUY" && htfBias === "BULLISH") ||
        (tempDir === "SELL" && htfBias === "BEARISH")
      ) {
        impulseHigh = Math.max(price, lastPrice);
        impulseLow = Math.min(price, lastPrice);
        direction = tempDir;
      }
    }

    // ===== Fib 0.5 Entry =====
    if (!tradeActive && impulseHigh && impulseLow) {
      const fib50 = impulseLow + (impulseHigh - impulseLow) * 0.5;

      if (Math.abs(price - fib50) < price * 0.00025) {
        entry = fib50;

        if (direction === "BUY") {
          sl = impulseLow;
          tp = entry + (entry - sl) * RR;
        } else {
          sl = impulseHigh;
          tp = entry - (sl - entry) * RR;
        }

        tradeActive = true;
        statusEl.innerText = "ACTIVE";
        statusEl.className = "badge active";

        logicEl.innerText =
          ${direction} @ ${entry.toFixed(2)} | SL ${sl.toFixed(2)} | TP ${tp.toFixed(2)} | RR 1:${RR};
      }
    }

    // ===== Trade Management =====
    if (tradeActive) {
      if (
        (direction === "BUY" && price >= tp) ||
        (direction === "SELL" && price <= tp)
      ) {
        statusEl.innerText = "TP HIT";
        statusEl.className = "badge tp";
        logicEl.innerText = "TP hit. Waiting new setup.";
        reset();
      }
      else if (
        (direction === "BUY" && price <= sl) ||
        (direction === "SELL" && price >= sl)
      ) {
        statusEl.innerText = "SL HIT";
        statusEl.className = "badge sl";
        logicEl.innerText = "SL hit. Setup failed.";
        reset();
      }
    }

    if (!tradeActive) {
      statusEl.innerText = "WAITING";
      statusEl.className = "badge waiting";
      if (!logicEl.innerText)
        logicEl.innerText = "Waiting HTF aligned impulse → Fib 0.5";
    }

    lastPrice = price;
  };

  function reset() {
    tradeActive = false;
    impulseHigh = impulseLow = direction = null;
  }
}

// INIT
createEngine(
  "btcusdt",
  document.getElementById("btcPrice"),
  document.getElementById("btcStatus"),
  document.getElementById("btcLogic"),
  document.getElementById("btcHTF")
);

createEngine(
  "ethusdt",
  document.getElementById("ethPrice"),
  document.getElementById("ethStatus"),
  document.getElementById("ethLogic"),
  document.getElementById("ethHTF")
);
</script>

</body>
</html>
